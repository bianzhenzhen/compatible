{"remainingRequest":"D:\\jrxcs_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\jrxcs_vue\\src\\views\\taskEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\jrxcs_vue\\src\\views\\taskEdit.vue","mtime":1552354020181},{"path":"D:\\jrxcs_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jrxcs_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\jrxcs_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\jrxcs_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nconst form = {\r\n\tproject:{\r\n\t\tid:'',\r\n\t\tname:'',\r\n\t\tdownloadUrl:'',\r\n\t\ttype:'',\r\n\t\tprojectManager:'',\r\n\t\ttestManager:'',\r\n\t},\r\n\ttask:{\r\n\t\tid:\"\",  \r\n\t\tcatalogId:\"\",  \r\n\t\tprojectId:\"\", \r\n\t\tsystemList:[], //提交时 system 字符\r\n\t\tversion:\"\", \r\n\t\tuploadFile:[],  //提交时 testCase\r\n\t\tkick:\"\",  \r\n\t\treceiveMail:\"\",  \r\n\t\tmodelsRemark:\"\",  \r\n\t},\r\n\taudit:true,\r\n\ttoEmail:'785188646@qq.com'\r\n}\r\nexport default{\r\n\tname:'taskEdit',\r\n\tdata(){\r\n\t\treturn{\r\n\t\t\tisEdit:this.$route.query.isEdit,\r\n\t\t\tform:{...form},\r\n\t\t\tsystem:[{\r\n\t\t\t\tindex:\"1\",\r\n\t\t\t\ttext:'安卓'\r\n\t\t\t},{\r\n\t\t\t\tindex:\"2\",\r\n\t\t\t\ttext:'IOS'\r\n\t\t\t}],\r\n\t\t\trules:{\r\n\t\t\t\t// name:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// downloadUrl:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// type:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// projectManager:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// testManager:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// projectId:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// version:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// receiveMail:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ]\r\n\t\t\t},\r\n\t\t}\r\n\t},\r\n\tmethods:{\r\n\t\texceed(files, fileList){\r\n\t\t\t// console.log(files, fileList)\r\n\t\t\tthis.$message.error(\"超出限制个数,请先删除列表已有的文件\");\r\n\t\t},\r\n\t\tsuccess(response, file, fileList){\r\n\t\t\tconsole.log(response, file, fileList);\r\n\t\t\tconst {status, data} = response;\r\n\t\t\tif(!status){\r\n\t\t\t\tthis.$message.success(\"上传成功！\");\r\n\t\t\t\tresponse.data.name = response.data.fileName;\r\n\t\t\t\tthis.form.task.uploadFile.push(response.data);\r\n\t\t\t}else{\r\n\t\t\t\tthis.$message.error(data);\r\n\t\t\t\tthis.form.task.uploadFile = [];\r\n\t\t\t}\r\n\t\t},\r\n\t\tremove(files, fileList){\r\n\t\t\tthis.form.task.uploadFile = fileList;\r\n\t\t},\r\n\t\tgetCheckboxVal(labelArr){\r\n\t\t\tlet valArr = [];\r\n\t\t\tthis.system.forEach(item=>{\r\n\t\t\t\tlabelArr.forEach(item1=>{\r\n\t\t\t\t\tif(item.text == item1) {valArr.push(item.index)}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\treturn valArr\r\n\t\t},\r\n\t\tgetCheckboxLabel(valArr){\r\n\t\t\tlet labelArr = [];\r\n\t\t\tthis.system.forEach(item=>{\r\n\t\t\t\tvalArr.forEach(item1=>{\r\n\t\t\t\t\tif(item.index == item1) {labelArr.push(item.text)}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\treturn labelArr\r\n\t\t},\r\n\t\tonSubmit(){\r\n\t\t\tthis.$refs.form.validate((valid,obj)=>{\r\n\t\t\t\tif(valid){\r\n\t\t\t\t\tconst systemList = this.getCheckboxVal(this.form.task.systemList); \r\n\t\t\t\t\tlet data = JSON.parse(JSON.stringify(this.form));\r\n\t\t\t\t\tdata.task.system = systemList.join(\",\");\r\n\t\t\t\t\tdata.task.testCase = this.form.task.uploadFile.length?this.form.task.uploadFile[0].id:'';\r\n\t\t\t\t\tdelete data.task.systemList;\r\n\t\t\t\t\tdelete data.task.uploadFile;\r\n\t\t\t\t\tthis.$axios.post('/api/task/auditTask',{...data})\r\n\t\t\t\t\t.then(res=>{\r\n\t\t\t\t\t\tconst {status, data} = res.data;\r\n\t\t\t\t\t\tif(!status){\r\n\t\t\t\t\t\t\tthis.$message.success(data);\r\n\t\t\t\t\t\t\tthis.$router.push(\"proManage\")\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcancel(){\r\n\t\t\tthis.$refs.form.resetFields();\r\n\t\t\t// this.form = {...form};\r\n\t\t\t// this.fileList = [];\r\n\t\t\tthis.$router.push(\"proManage\")\r\n\t\t},\r\n\t\tgetProTask(){\r\n\r\n\t\t\tconst id = this.$route.query.id;\r\n\t\t\tthis.$axios.get('/api/task/getTask', {params:{id}})\r\n\t\t\t.then((res)=>{\r\n\t\t\t\tconst {status, data} = res.data;\r\n\t\t\t\tconst {keys, is} = Object;\r\n\t\t\t\tif(!status){\r\n\t\t\t\t\tfor(let key of keys(this.form.project)){\r\n\t\t\t\t\t\tthis.form.project[key]=data.project[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(let key of keys(this.form.task)){\r\n\t\t\t\t\t\tthis.form.task[key]=data[key];\r\n\t\t\t\t\t\tif(is(key,\"systemList\")){\r\n\t\t\t\t\t\t\tthis.form.task[key]=this.getCheckboxLabel(data[key]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(is(key,\"uploadFile\")){\r\n\t\t\t\t\t\t\tthis.form.task[key] = []\r\n\t\t\t\t\t\t\tif(data[key]){\r\n\t\t\t\t\t\t\t\tconst {fileName,fullPath, id} = data[key];\r\n\t\t\t\t\t\t\t\tif(fileName&&fullPath&&id) this.form.task[key]=[{name:fileName,url:'/api'+fullPath,id}];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tmounted(){\r\n\t\tthis.getProTask();\r\n\t}\r\n}\r\n",{"version":3,"sources":["taskEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"taskEdit.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n\t<div class=\"wrap\">\r\n\t\t<el-form ref=\"form\" :model=\"form\" label-width=\"140px\" :rules=\"rules\">\r\n\t\t <el-form-item label=\"项目名称：\" prop=\"name\">\r\n\t\t    <el-input v-model=\"form.project.name\" placeholder=\"请输入项目名称\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"下载地址：\" prop=\"downloadUrl\">\r\n\t\t    <el-input v-model=\"form.project.downloadUrl\" placeholder=\"请输入下载地址名称\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"平台类型：\" prop=\"type\">\r\n\t\t    <el-select v-model=\"form.project.type\" placeholder=\"请选择平台类型\">\r\n\t\t      <el-option label=\"手机\" value=\"1\"></el-option>\r\n\t\t      <el-option label=\"PAD\" value=\"2\"></el-option>\r\n\t\t      <el-option label=\"H5\" value=\"3\"></el-option>\r\n\t\t      <el-option label=\"微信\" value=\"4\"></el-option>\r\n\t\t    </el-select>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"项目经理：\" prop=\"projectManager\">\r\n\t\t    <el-input v-model=\"form.project.projectManager\" placeholder=\"请输入项目经理\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"测试经理：\" prop=\"testManager\">\r\n\t\t    <el-input v-model=\"form.project.testManager\" placeholder=\"请输入测试经理\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"系统选择\">\r\n\t\t    <el-checkbox-group v-model=\"form.task.systemList\">\r\n\t\t      <el-checkbox :label=\"item.text\" name=\"systemList\" v-for=\"item in system\" :key=\"item.index\"></el-checkbox>\r\n\t\t    </el-checkbox-group>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"版本\" prop=\"version\">\r\n\t\t    <el-input v-model=\"form.task.version\" placeholder=\"请填写版本\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"测试用例选择\">\r\n\t\t    <el-upload\r\n\t\t\t  class=\"upload-demo\"\r\n\t\t\t  action=\"/api/file/upload\"\r\n\t\t\t  multiple\r\n\t\t\t  :limit=\"1\"\r\n\t\t\t  :on-exceed=\"exceed\"\r\n\t\t\t  :on-success=\"success\"\r\n\t\t\t  :on-remove=\"remove\"\r\n\t\t\t  :file-list=\"form.task.uploadFile\">\r\n\t\t\t  <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n\t\t\t  <div slot=\"tip\" class=\"el-upload__tip\">只能上传一个文件，且不超过20M</div>\r\n\t\t\t</el-upload>\r\n\t\t\t<div class=\"care\">*注：标准兼容性测试用例默认覆盖各1,2级页面，如有特殊需求请上传用例，如果没有请选择无</div>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"测试账号是否互踢\">\r\n\t\t    <el-select v-model=\"form.task.kick\" placeholder=\"请选择\">\r\n\t\t      <el-option label=\"是\" value=\"1\"></el-option>\r\n\t\t      <el-option label=\"否\" value=\"2\"></el-option>\r\n\t\t    </el-select>\r\n\t\t    <div class=\"care\">*注：如果账号存在互踢，请至少准备30个账号随测试用例上传</div>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"报告接收邮箱\" prop=\"receiveMail\">\r\n\t\t    <el-input v-model=\"form.task.receiveMail\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"机型备注\">\r\n\t\t    <el-input v-model=\"form.task.modelsRemark\" placeholder=\"默认IOS TOP50  安卓TOP250\"></el-input>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item label=\"供应商选择：\" prop=\"toEmail\">\r\n\t\t    <el-select v-model=\"form.toEmail\" placeholder=\"请选择供应商\">\r\n\t\t      <el-option label=\"785188646@qq.com\" value=\"785188646@qq.com\"></el-option>\r\n\t\t      <el-option label=\"123456@qq.com\" value=\"2\"></el-option>\r\n\t\t    </el-select>\r\n\t\t  </el-form-item>\r\n\t\t  <el-form-item>\r\n\t\t    <el-button type=\"primary\" @click=\"onSubmit\" v-if=\"isEdit\">通过</el-button>\r\n\t\t    <el-button @click=\"cancel\">取消</el-button>\r\n\t\t  </el-form-item>\r\n\t\t</el-form>\r\n\t</div>\r\n</template>\r\n<script>\r\nconst form = {\r\n\tproject:{\r\n\t\tid:'',\r\n\t\tname:'',\r\n\t\tdownloadUrl:'',\r\n\t\ttype:'',\r\n\t\tprojectManager:'',\r\n\t\ttestManager:'',\r\n\t},\r\n\ttask:{\r\n\t\tid:\"\",  \r\n\t\tcatalogId:\"\",  \r\n\t\tprojectId:\"\", \r\n\t\tsystemList:[], //提交时 system 字符\r\n\t\tversion:\"\", \r\n\t\tuploadFile:[],  //提交时 testCase\r\n\t\tkick:\"\",  \r\n\t\treceiveMail:\"\",  \r\n\t\tmodelsRemark:\"\",  \r\n\t},\r\n\taudit:true,\r\n\ttoEmail:'785188646@qq.com'\r\n}\r\nexport default{\r\n\tname:'taskEdit',\r\n\tdata(){\r\n\t\treturn{\r\n\t\t\tisEdit:this.$route.query.isEdit,\r\n\t\t\tform:{...form},\r\n\t\t\tsystem:[{\r\n\t\t\t\tindex:\"1\",\r\n\t\t\t\ttext:'安卓'\r\n\t\t\t},{\r\n\t\t\t\tindex:\"2\",\r\n\t\t\t\ttext:'IOS'\r\n\t\t\t}],\r\n\t\t\trules:{\r\n\t\t\t\t// name:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// downloadUrl:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// type:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// projectManager:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// testManager:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// projectId:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// version:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ],\r\n\t\t\t\t// receiveMail:[\r\n\t\t\t\t// \t{required:true,message:'必填'}\r\n\t\t\t\t// ]\r\n\t\t\t},\r\n\t\t}\r\n\t},\r\n\tmethods:{\r\n\t\texceed(files, fileList){\r\n\t\t\t// console.log(files, fileList)\r\n\t\t\tthis.$message.error(\"超出限制个数,请先删除列表已有的文件\");\r\n\t\t},\r\n\t\tsuccess(response, file, fileList){\r\n\t\t\tconsole.log(response, file, fileList);\r\n\t\t\tconst {status, data} = response;\r\n\t\t\tif(!status){\r\n\t\t\t\tthis.$message.success(\"上传成功！\");\r\n\t\t\t\tresponse.data.name = response.data.fileName;\r\n\t\t\t\tthis.form.task.uploadFile.push(response.data);\r\n\t\t\t}else{\r\n\t\t\t\tthis.$message.error(data);\r\n\t\t\t\tthis.form.task.uploadFile = [];\r\n\t\t\t}\r\n\t\t},\r\n\t\tremove(files, fileList){\r\n\t\t\tthis.form.task.uploadFile = fileList;\r\n\t\t},\r\n\t\tgetCheckboxVal(labelArr){\r\n\t\t\tlet valArr = [];\r\n\t\t\tthis.system.forEach(item=>{\r\n\t\t\t\tlabelArr.forEach(item1=>{\r\n\t\t\t\t\tif(item.text == item1) {valArr.push(item.index)}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\treturn valArr\r\n\t\t},\r\n\t\tgetCheckboxLabel(valArr){\r\n\t\t\tlet labelArr = [];\r\n\t\t\tthis.system.forEach(item=>{\r\n\t\t\t\tvalArr.forEach(item1=>{\r\n\t\t\t\t\tif(item.index == item1) {labelArr.push(item.text)}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\treturn labelArr\r\n\t\t},\r\n\t\tonSubmit(){\r\n\t\t\tthis.$refs.form.validate((valid,obj)=>{\r\n\t\t\t\tif(valid){\r\n\t\t\t\t\tconst systemList = this.getCheckboxVal(this.form.task.systemList); \r\n\t\t\t\t\tlet data = JSON.parse(JSON.stringify(this.form));\r\n\t\t\t\t\tdata.task.system = systemList.join(\",\");\r\n\t\t\t\t\tdata.task.testCase = this.form.task.uploadFile.length?this.form.task.uploadFile[0].id:'';\r\n\t\t\t\t\tdelete data.task.systemList;\r\n\t\t\t\t\tdelete data.task.uploadFile;\r\n\t\t\t\t\tthis.$axios.post('/api/task/auditTask',{...data})\r\n\t\t\t\t\t.then(res=>{\r\n\t\t\t\t\t\tconst {status, data} = res.data;\r\n\t\t\t\t\t\tif(!status){\r\n\t\t\t\t\t\t\tthis.$message.success(data);\r\n\t\t\t\t\t\t\tthis.$router.push(\"proManage\")\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcancel(){\r\n\t\t\tthis.$refs.form.resetFields();\r\n\t\t\t// this.form = {...form};\r\n\t\t\t// this.fileList = [];\r\n\t\t\tthis.$router.push(\"proManage\")\r\n\t\t},\r\n\t\tgetProTask(){\r\n\r\n\t\t\tconst id = this.$route.query.id;\r\n\t\t\tthis.$axios.get('/api/task/getTask', {params:{id}})\r\n\t\t\t.then((res)=>{\r\n\t\t\t\tconst {status, data} = res.data;\r\n\t\t\t\tconst {keys, is} = Object;\r\n\t\t\t\tif(!status){\r\n\t\t\t\t\tfor(let key of keys(this.form.project)){\r\n\t\t\t\t\t\tthis.form.project[key]=data.project[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(let key of keys(this.form.task)){\r\n\t\t\t\t\t\tthis.form.task[key]=data[key];\r\n\t\t\t\t\t\tif(is(key,\"systemList\")){\r\n\t\t\t\t\t\t\tthis.form.task[key]=this.getCheckboxLabel(data[key]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(is(key,\"uploadFile\")){\r\n\t\t\t\t\t\t\tthis.form.task[key] = []\r\n\t\t\t\t\t\t\tif(data[key]){\r\n\t\t\t\t\t\t\t\tconst {fileName,fullPath, id} = data[key];\r\n\t\t\t\t\t\t\t\tif(fileName&&fullPath&&id) this.form.task[key]=[{name:fileName,url:'/api'+fullPath,id}];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tmounted(){\r\n\t\tthis.getProTask();\r\n\t}\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.fl{\r\n\tfloat:left;\r\n}\r\n.span-font{\r\n\tfont-size: 20px;\r\n    color:gray;\r\n}\r\n.wrap{\r\n\t@extend .span-font;\r\n\twidth: 70%;\r\n    text-align:left;\r\n    .care{\r\n    \tcolor: #c0c4cc;\r\n    }\r\n}\r\n\r\n</style>"]}]}